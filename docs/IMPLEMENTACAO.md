# Sistema de Agendamento com WhatsApp

## Vis√£o Geral
Implementa√ß√£o de um sistema de agendamento integrado com WhatsApp para o site da fot√≥grafa, permitindo que clientes visualizem datas dispon√≠veis, agendem sess√µes e recebam confirma√ß√µes via WhatsApp. O sistema inclui um painel privado para a fot√≥grafa gerenciar agendamentos.

## Funcionalidades Principais

### 1. Calend√°rio Interativo ‚úÖ
- Visualiza√ß√£o de datas dispon√≠veis e ocupadas
- Sele√ß√£o de hor√°rios por clientes
- Diferentes visualiza√ß√µes (m√™s, semana, dia)
- C√≥digo de cores para status dos agendamentos

### 2. Banco de Dados (Supabase) ‚úÖ
- Tabela de datas dispon√≠veis
- Tabela de agendamentos
- Tabela de usu√°rios (fot√≥grafa)
- Pol√≠ticas de seguran√ßa implementadas
- √çndices para otimiza√ß√£o

### 3. Integra√ß√£o WhatsApp ‚úÖ
- Notifica√ß√£o via wa.me para fot√≥grafa sobre novos agendamentos
- Link direto para painel de confirma√ß√£o
- Notifica√ß√£o para clientes sobre status do agendamento
- **Mensagens autom√°ticas de cancelamento** üÜï
- **Mensagens autom√°ticas de reagendamento** üÜï
- **Bot√µes de contato direto no dashboard** üÜï
- **Fallback entre WhatsApp Business API e wa.me** üÜï
- Valida√ß√£o de n√∫meros brasileiros com DDD
- C√≥pia r√°pida de n√∫meros de telefone

### 4. Sistema de Autentica√ß√£o üÜï
- Login da fot√≥grafa com telefone + senha
- Autentica√ß√£o via Supabase Auth
- Prote√ß√£o de rotas privadas
- Sess√£o persistente

### 5. Painel Administrativo üÜï
- Dashboard privado da fot√≥grafa
- Listagem de agendamentos pendentes
- Listagem de agendamentos confirmados
- A√ß√µes de confirmar/rejeitar agendamentos
- Logout seguro

### 6. Interface do Usu√°rio
- Formul√°rio de agendamento com valida√ß√£o ‚úÖ
- Calend√°rio responsivo ‚úÖ
- Feedback visual de status ‚úÖ
- Valida√ß√£o de telefone brasileiro ‚úÖ
- M√°scara de telefone ‚úÖ
- Modal de confirma√ß√£o ‚è≥
- P√°gina de login ‚è≥
- Dashboard administrativo ‚è≥

## Tecnologias Utilizadas
- React + TypeScript
- Supabase (Banco de Dados + Auth)
- React Big Calendar
- WhatsApp wa.me (integra√ß√£o simplificada)
- TailwindCSS
- React Router (prote√ß√£o de rotas)
- Context API (gerenciamento de estado)

## Progresso da Implementa√ß√£o

### Fase 1: Estrutura B√°sica ‚úÖ (100%)
- [x] Cria√ß√£o dos tipos TypeScript
- [x] Implementa√ß√£o do componente de calend√°rio
- [x] Configura√ß√£o do banco de dados Supabase
- [x] Configura√ß√£o das vari√°veis de ambiente

### Fase 2: Funcionalidades Core ‚úÖ (100%)
- [x] Servi√ßos de integra√ß√£o com Supabase
- [x] Servi√ßo de notifica√ß√£o WhatsApp (wa.me)
- [x] **Mensagens autom√°ticas de cancelamento via WhatsApp** üÜï
- [x] **Mensagens autom√°ticas de reagendamento via WhatsApp** üÜï
- [x] **Sistema h√≠brido WhatsApp Business API + wa.me** üÜï
- [x] Pol√≠ticas de seguran√ßa e RLS
- [x] Valida√ß√£o de formul√°rios
- [x] Valida√ß√£o de telefone brasileiro
- [x] Utilit√°rios de formata√ß√£o de telefone

### Fase 3: Sistema de Autentica√ß√£o ‚è≥ (0%)
- [ ] Configura√ß√£o Supabase Auth
- [ ] P√°gina de login
- [ ] Prote√ß√£o de rotas
- [ ] Context de autentica√ß√£o
- [ ] Middleware de autentica√ß√£o

### Fase 4: Painel Administrativo ‚úÖ (100%)
- [x] Dashboard da fot√≥grafa
- [x] Listagem de agendamentos pendentes
- [x] Listagem de agendamentos confirmados
- [x] A√ß√µes de confirmar/rejeitar/cancelar/reagendar
- [x] **Bot√µes de contato direto via WhatsApp** üÜï
- [x] **Bot√£o para copiar n√∫mero do cliente** üÜï
- [x] **Feedback autom√°tico de envio de mensagens** üÜï
- [x] Interface responsiva do painel

### Fase 5: Interface e UX ‚è≥ (75%)
- [x] Implementa√ß√£o do calend√°rio responsivo
- [x] Feedback visual de status
- [x] Valida√ß√£o em tempo real
- [x] M√°scara de telefone
- [ ] Modal de confirma√ß√£o de agendamento
- [ ] Melhorias de UX no painel

### Fase 6: Testes e Refinamentos ‚è≥ (90%)
- [x] Implementar autentica√ß√£o com Supabase
- [x] Criar p√°gina de login para fot√≥grafo
- [x] Desenvolver dashboard administrativo
- [x] Implementar gerenciamento de agendamentos
- [x] Adicionar funcionalidades de confirma√ß√£o/cancelamento
- [x] Criar contexto de autentica√ß√£o
- [x] Implementar prote√ß√£o de rotas
- [x] Criar servi√ßos do dashboard
- [ ] Configurar usu√°rio administrador no Supabase
- [ ] Testar fluxo completo
- [ ] Testes de integra√ß√£o
- [ ] Testes de unidade
- [ ] Otimiza√ß√£o de performance
- [ ] Documenta√ß√£o de uso

## Pr√≥ximos Passos
1. **Configurar Supabase Auth**
   - Habilitar autentica√ß√£o por telefone
   - Configurar pol√≠ticas de usu√°rio
   - Criar tabela de usu√°rios

2. **Implementar Sistema de Login**
   - P√°gina de login (/login)
   - Valida√ß√£o de credenciais
   - Redirecionamento p√≥s-login

3. **Desenvolver Painel Administrativo**
   - Dashboard (/dashboard)
   - Prote√ß√£o de rota
   - Listagem de agendamentos
   - A√ß√µes de confirmar/rejeitar

4. **Integra√ß√£o WhatsApp Avan√ßada** ‚úÖ
   - [x] Links personalizados com dados do agendamento
   - [x] Mensagens autom√°ticas de confirma√ß√£o
   - [x] **Mensagens autom√°ticas de cancelamento** üÜï
   - [x] **Mensagens autom√°ticas de reagendamento** üÜï
   - [x] **Sistema h√≠brido API + wa.me com fallback** üÜï
   - [x] **Bot√µes de contato direto no dashboard** üÜï
   - [x] Notifica√ß√µes para cliente

5. **Implementar Funcionalidades Avan√ßadas**
   - Modal de confirma√ß√£o de agendamento
   - Edi√ß√£o de agendamentos (futuro)
   - Relat√≥rios e estat√≠sticas

6. **Testes e Refinamentos**
   - Testes automatizados
   - Otimiza√ß√£o de performance
   - Documenta√ß√£o completa

## Fluxo do Sistema

### Para o Cliente:
1. Acessa o site e visualiza o calend√°rio
2. Seleciona data/hor√°rio dispon√≠vel
3. Preenche formul√°rio com dados pessoais
4. Sistema valida telefone brasileiro (DDD obrigat√≥rio)
5. Agendamento √© criado com status "pending"
6. Cliente recebe link wa.me informando que aguarda confirma√ß√£o

### Para a Fot√≥grafa:
1. Recebe notifica√ß√£o via WhatsApp com link para o painel
2. Acessa /login e faz autentica√ß√£o
3. Visualiza dashboard com agendamentos pendentes e confirmados
4. Confirma, rejeita, cancela ou reagenda agendamentos
5. **Envia mensagens autom√°ticas via WhatsApp para cancelamentos/reagendamentos** üÜï
6. **Usa bot√µes de contato direto para comunica√ß√£o r√°pida** üÜï
7. **Copia n√∫meros de telefone com um clique** üÜï
8. Cliente recebe notifica√ß√£o autom√°tica do status

## Estrutura do Banco de Dados

### Tabelas Existentes:
- `available_dates` - Datas e hor√°rios dispon√≠veis
- `schedulings` - Agendamentos dos clientes

### Novas Tabelas Necess√°rias:
- `auth.users` - Usu√°rios do sistema (Supabase Auth)
- `user_profiles` - Perfis estendidos (dados da fot√≥grafa)

### Campos Adicionais:
- `schedulings.status` - pending, confirmed, rejected
- `schedulings.confirmed_at` - timestamp da confirma√ß√£o
- `schedulings.confirmed_by` - ID do usu√°rio que confirmou

## Configura√ß√£o do Sistema

### Configura√ß√£o do Usu√°rio Administrador

Para configurar o acesso administrativo ao dashboard:

#### 1. Acesse o Supabase Dashboard
- V√° para [supabase.com](https://supabase.com)
- Fa√ßa login na sua conta
- Selecione seu projeto

#### 2. Criar Usu√°rio Administrador
- Navegue para `Authentication > Users`
- Clique em `Add user`
- Preencha os dados:
  - **Email**: `[TELEFONE]@gracefotografia.com` (ex: `11987654321@gracefotografia.com`)
  - **Password**: Sua senha escolhida
  - **Email Confirm**: ‚úÖ Marque como confirmado
- Clique em `Create user`

#### 3. Formato do Login
- **Telefone**: Digite apenas os n√∫meros (ex: `11987654321`)
- **Senha**: A senha configurada no Supabase

#### 4. Exemplo de Configura√ß√£o
```
Telefone do fot√≥grafo: (11) 98765-4321
Email no Supabase: 11987654321@gracefotografia.com
Login no app: 11987654321
Senha: MinhaSenh@123
```

#### 5. Acessar o Dashboard
- V√° para `/login` no site
- Digite o telefone (apenas n√∫meros)
- Digite a senha
- Ser√° redirecionado para `/dashboard`

## Notas de Implementa√ß√£o
- A estrutura do banco de dados est√° otimizada para consultas frequentes
- Implementada prote√ß√£o contra duplo agendamento
- Sistema preparado para m√∫ltiplos fusos hor√°rios
- Logs detalhados para rastreamento de problemas
- Valida√ß√£o de telefone brasileiro com DDD obrigat√≥rio
- **Sistema h√≠brido de WhatsApp**: tenta WhatsApp Business API primeiro, fallback para wa.me üÜï
- **Mensagens personalizadas** para cada tipo de a√ß√£o (cancelamento, reagendamento) üÜï
- **Feedback visual** informando se mensagem foi enviada automaticamente ou requer a√ß√£o manual üÜï
- **Bot√µes de a√ß√£o r√°pida** no dashboard para contato direto com clientes üÜï

## Considera√ß√µes de Seguran√ßa
- Todas as credenciais est√£o em vari√°veis de ambiente
- Implementadas pol√≠ticas de RLS no Supabase
- Valida√ß√£o de dados no frontend e backend
- Rate limiting para preven√ß√£o de spam
- Autentica√ß√£o segura via Supabase Auth
- Prote√ß√£o de rotas administrativas
- Sess√µes com timeout autom√°tico

## Documenta√ß√£o Adicional
- `docs/whatsapp-business-api-integration.md` - Integra√ß√£o WhatsApp Business API (alternativa)
- `src/utils/phoneUtils.ts` - Utilit√°rios de valida√ß√£o de telefone
- `src/services/schedulingService.ts` - Servi√ßos de agendamento

## Funcionalidades WhatsApp Implementadas üÜï

### 1. Mensagens Autom√°ticas de Cancelamento
- Enviadas automaticamente quando um agendamento √© cancelado
- Inclui dados do agendamento (data, hor√°rio, servi√ßo)
- Motivo do cancelamento personalizado
- Fallback para WhatsApp Web se API n√£o configurada

### 2. Mensagens Autom√°ticas de Reagendamento
- Enviadas quando um agendamento precisa ser reagendado
- Inclui dados do agendamento original
- Motivo do reagendamento
- Instru√ß√µes para novo agendamento

### 3. Sistema H√≠brido de Envio
- **Primeira tentativa**: WhatsApp Business API (se configurada)
- **Fallback**: Abertura do WhatsApp Web com mensagem pr√©-preenchida
- **Feedback visual**: Informa ao usu√°rio qual m√©todo foi usado

### 4. Bot√µes de Contato R√°pido
- **Bot√£o WhatsApp**: Abre chat direto com cliente
- **Bot√£o Copiar**: Copia n√∫mero do cliente para √°rea de transfer√™ncia
- Dispon√≠vel em todos os cards de agendamento
- Mensagens contextuais baseadas no status do agendamento

### 5. Configura√ß√£o da API WhatsApp Business
```javascript
// Em src/services/schedulingService.ts
const WHATSAPP_API_URL = process.env.REACT_APP_WHATSAPP_API_URL;
const WHATSAPP_API_TOKEN = process.env.REACT_APP_WHATSAPP_API_TOKEN;
```

### 6. Exemplos de Mensagens

#### Cancelamento:
```
üö´ Agendamento Cancelado

Ol√° [Nome]! Infelizmente precisei cancelar seu agendamento:

üìÖ Data: [Data]
‚è∞ Hor√°rio: [Hor√°rio]
üì∏ Servi√ßo: [Tipo]

‚ùå Motivo: [Motivo]

Por favor, entre em contato para reagendarmos.
```

#### Reagendamento:
```
üìÖ Reagendamento Necess√°rio

Ol√° [Nome]! Preciso reagendar seu agendamento:

üìÖ Data original: [Data]
‚è∞ Hor√°rio original: [Hor√°rio]
üì∏ Servi√ßo: [Tipo]

üîÑ Motivo: [Motivo]

Por favor, acesse o site para escolher uma nova data.
```

---

*√öltima atualiza√ß√£o: 23 de Fevereiro de 2025*
*Vers√£o: 2.1.0 - Funcionalidades WhatsApp Avan√ßadas*